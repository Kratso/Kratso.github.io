<html>

<head>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"></script>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">
    <script>
        var turn = true
            /*{
                       aInternal: true,
                       aListener: (val) => {},
                       set a(val) {
                           this.aInternal = val;
                           this.aListener(val);
                       },
                       get a() {
                           return this.aInternal;
                       },
                       registerListener: (listener) => {
                           this.aListener = listener;
                       }
                   }*/

        lines = [
            ['#tl', '#tc', '#tr'],
            ['#cl', '#cc', '#cr'],
            ['#bl', '#bc', '#br'],
            ['#bl', '#cl', '#tl'],
            ['#bl', '#cc', '#tr'],
            ['#bc', '#cc', '#tc'],
            ['#br', '#cr', '#tr'],
            ['#tl', '#cc', '#br']
        ]

        tiles = [
            '#tl', '#tc', '#tr',
            '#cl', '#cc', '#cr',
            '#bl', '#bc', '#br'
        ]

        $(document).ready(() => {

            $('#reset').click(() => {
                tiles.forEach((ele) => {
                    $(ele).removeClass('selected')
                    $(ele).removeClass('player')
                    $(ele).removeClass('ia')
                    $('#message').html("Game Reset!")
                    turn = true
                })
            })

            /*turn.registerListener((val) => {
                console.log(val)
                if (!val) {
                     if (typeof(win()) == "undefined") {
                          if (typeof(nearvictory()) == "undefined") {
                              $()
                          } else {
                              $('.board').each(() => {
                                  if (!$(this).hasClass('selected')) {
                                      $(this).addClass('selected')
                                      $(this).addClass('ia')
                                      return
                                  }
                              })
                          }
                      } else {
                          $(win()).addClass('ia')
                      }
                      if (endGame()) {
                          $('#message').html("Game Ended!" + victory() ? " You Win!" : "You Lose...")
                      } else {
                          $('#message').html("Next Turn!")
                          turn.a = true
					  }
                    console.log("falsazo")
                    $(shuffle(tiles.filter((val) => !$(val).hasClass('selected')))[0]).addClass('selected').addClass('ia')
                    turn.a = true
                    checkEnd()
                }
			})*/
            /*s tiles.forEach((ele) => {
                 $(ele).click((el) => {
                     console.log(el)
                     if (turn) {
                         if (!$(el).hasClass('selected')) {

                             $(el).addClass('selected')
                             $(el).addClass('player')

                             turn = false;

                             checkEnd()

                             $(shuffle(tiles.filter((val) => !$(val).hasClass('selected')))[0]).addClass('selected').addClass('ia')

                             turn = true

                             checkEnd()
                         }
                     }
                 })
			 })*/
            $('.top').children().each(function() {
                var som = $(this)
                $(this).click(() => {
                    if (turn) {
                        if (!som.hasClass('selected')) {
                            som.addClass('selected')
                            som.addClass('player')
                            turn = false
                            if (!checkEnd()) {
                                enemy = $(shuffle(tiles.filter((val) => !$(val).hasClass('selected')))[0])
                                enemy.addClass('selected')
                                enemy.addClass('ia')
                                turn = true
                                checkEnd()
                            } else {
                                turn = false
                            }
                        }
                    }
                })
            })
            $('.centre').children().each(function() {
                var som = $(this)
                $(this).click(() => {
                    if (turn) {
                        if (!som.hasClass('selected')) {
                            som.addClass('selected')
                            som.addClass('player')
                            turn = false
                            if (!checkEnd()) {
                                enemy = $(shuffle(tiles.filter((val) => !$(val).hasClass('selected')))[0])
                                enemy.addClass('selected')
                                enemy.addClass('ia')
                                turn = true
                                checkEnd()
                            } else {
                                turn = false
                            }
                        }
                    }
                })
            })
            $('.bottom').children().each(function() {
                var som = $(this)
                $(this).click(() => {
                    if (turn) {
                        if (!som.hasClass('selected')) {
                            som.addClass('selected')
                            som.addClass('player')
                            turn = false
                            if (!checkEnd()) {
                                enemy = $(shuffle(tiles.filter((val) => !$(val).hasClass('selected')))[0])
                                enemy.addClass('selected')
                                enemy.addClass('ia')
                                turn = true
                                checkEnd()
                            } else {
                                turn = false
                            }
                        }
                    }
                })
            })
        })

        function checkEnd() {
            if (endGame()) {
                $('#message').html("Game Ended!" + (victory() ? " You Win!" : " You Lose..."))
            } else {
                $('#message').html("Next Turn!")
            }
        }

        function endGame() {
            player = []
            lines.forEach((ele) => {
                player.push(ele.map((x) => $(x).hasClass('player') ? 1 : 0).reduce((acc, val) => acc + val))
            })
            ia = []
            lines.forEach((ele) => {
                ia.push(ele.map((x) => $(x).hasClass('ia') ? 1 : 0).reduce((acc, val) => acc + val))
            })
            return ia.reduce((acc, val) => acc > val ? acc : val) == 3 ||
                player.reduce((acc, val) => acc > val ? acc : val) == 3 ||
                tiles.filter((ele) => !$(ele).hasClass('selected')).length == 0
        }

        function win() {
            return (lines
                    .map((val) => val.reduce((acc, val) => $(val).hasClass('ia') ?
                        acc + 1 :
                        acc), 0)
                    .reduce((acc, val) => acc > val ?
                        acc :
                        val) == 2) ?
                "" :
                undefined
        }

        function victory() {
            player = []
            acc = 0
            lines.forEach((array) => {
                player.push(array.map((ele) => $(ele).hasClass('player') ? 1 : 0).reduce((acc, element) => acc + element))
            })
            turn = false
            console.log(player)
            return player.reduce((acc, val) => acc > val ? acc : val) == 3
        }

        function lose() {}

        function nearvictory() {
            return (lines
                    .map((val) => val.reduce((acc, val) => $(val).hasClass('player') ?
                        acc + 1 :
                        acc), 0)
                    .reduce((acc, val) => acc > val ?
                        acc :
                        val) == 2) ?
                "" :
                undefined
        }

        function shuffle(array) {
            var currentIndex = array.length,
                temporaryValue, randomIndex;

            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;

                // And swap it with the current element.
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }

            return array;
        }
    </script>
    <style>
        body {
            background: linear-gradient(90deg, #00d0f0, #50a0f0);
            font-family: "Raleway", sans-serif;
        }
        
        h1 {
            padding: 5vh;
            margin-left: 10vw;
            font-size: 40px;
        }
        
        h3 {
            padding: 5vh;
            margin-left: 10vw;
            font-size: 25px;
        }
        
        h5 {
            padding: 5vh;
            margin-left: 10vw;
            font-size: 16px;
        }
        
        div {
            margin: 0;
            padding: 0;
        }
        
        a {
            color: #ede;
        }
        
        a:hover {
            color: #cbc;
        }
        
        a:visited {
            color: #ede;
        }
        
        .board {
            height: 10vw;
            background: #20a0f0;
        }
        
        .top,
        .centre,
        .bottom {
            margin-left: 15vw;
		padding:0;
        }
        
        .top {
            padding-top: 1vw;
            border-bottom: 4px solid black;
        }
        
        .centre {
            border-top: 4px solid black;
            border-bottom: 4px solid black;
        }
        
        .bottom {
            padding-bottom: 1vw;
            border-top: 4px solid black;
        }
        
        .player {
            background-image: url('https://www.dreamincode.net/forums/uploads/monthly_10_2010/post-0-12884151170642.png');
            background-repeat: no-repeat;
            background-size: contain;
            background-position: center;
        }
        
        .ia {
            background-image: url('https://www.dreamincode.net/forums/uploads/post-97990-1260678617.png');
            background-repeat: no-repeat;
            background-size: contain;
            background-position: center;
        }
        
        .butn {
            background: #3498db;
            background-image: -webkit-linear-gradient(top, #3498db, #2980b9);
            background-image: -moz-linear-gradient(top, #3498db, #2980b9);
            background-image: -ms-linear-gradient(top, #3498db, #2980b9);
            background-image: -o-linear-gradient(top, #3498db, #2980b9);
            background-image: linear-gradient(to bottom, #3498db, #2980b9);
            -webkit-border-radius: 28;
            -moz-border-radius: 28;
            border-radius: 28px;
            font-family: Arial;
            color: #ffffff;
            font-size: 20px;
            padding: 10px 20px 10px 20px;
            text-decoration: none;
            margin-left: 22vw;
        }
        
        .butn:hover {
            background: #3cb0fd;
            background-image: -webkit-linear-gradient(top, #3cb0fd, #3498db);
            background-image: -moz-linear-gradient(top, #3cb0fd, #3498db);
            background-image: -ms-linear-gradient(top, #3cb0fd, #3498db);
            background-image: -o-linear-gradient(top, #3cb0fd, #3498db);
            background-image: linear-gradient(to bottom, #3cb0fd, #3498db);
            text-decoration: none;
        }
        
        #tl {
            border-right: 4px solid black;
        }
        
        #tc {
            border-right: 4px solid black;
            border-left: 4px solid black;
        }
        
        #tr {
            border-left: 4px solid black;
        }
        
        #cr {
            border-left: 4px solid black;
        }
        
        #cc {
            border-right: 4px solid black;
            border-left: 4px solid black;
        }
        
        #cl {
            border-right: 4px solid black;
        }
        
        #bl {
            border-right: 4px solid black;
        }
        
        #bc {
            border-right: 4px solid black;
            border-left: 4px solid black;
        }
        
        #br {
            border-left: 4px solid black;
        }
        
        #container {
            width: 100vw;
            max-width: 200vw;
        }
        
        #header {
            background: #1070e0;
            margin-bottom: 5vh;
            border-bottom: 1px solid black;
            width: 100vw!important;
            max-width: 1000000vw;
            color: white;
            font-weight: bold;
        }
        
        #footer {
            background: #1070e0;
            margin-top: 5vh;
            border-top: 1px solid black;
            width: 100vw!important;
            max-width: 1000000vw;
            color: white;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div id="container" class="col-12 row">
        <div class="col-12" id="header">
            <h1 class="col-12">Welcome to TicTacToe JS/HTML!</h1>
            <h3 class=col-12>This is a simple TicTacToe game made with JQuery and HTML. Have Fun!</h3>
            <h5 id="message">Start at any moment by selecting your first tile!</h5>
        </div>
        <div class="top col-5 row">
            <div id="tl" class="col-4 board"></div>
            <div id="tc" class="col-4 board"></div>
            <div id="tr" class="col-4 board"></div>
        </div>
        <div class="centre col-5 row">
            <div id="cl" class="col-4 board"></div>
            <div id="cc" class="col-4 board"></div>
            <div id="cr" class="col-4 board"></div>
        </div>
        <div class="bottom col-5 row">
            <div id="bl" class="col-4 board"></div>
            <div id="bc" class="col-4 board"></div>
            <div id="br" class="col-4 board"></div>
        </div>
        <div class="col-12">
            <button class="butn col-lg-3 offset-2" id="reset"> RESET</button>
        </div>
        <div class="col-12" id="footer">
            <h5><a href="https://Kratso.github.io" target="_blank">Some of my other projects....</a></h5>
        </div>
    </div>
</body>

</html>
